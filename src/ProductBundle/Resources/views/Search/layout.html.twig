{#

This file is part of the Sonata package.

(c) Thomas Rabaix <thomas.rabaix@sonata-project.org>

For the full copyright and license information, please view the LICENSE
file that was distributed with this source code.

#}

{% sonata_template_box 'This is the catalog template. Feel free to override it.' %}

{% block sonata_page_breadcrumb %}
    <div class="row-fluid clearfix">
        {{ sonata_block_render_event('breadcrumb', { 'context': 'catalog', 'category': category, 'current_uri': app.request.requestUri }) }}
    </div>
{% endblock %}

<div class="row">

    <div class="col-sm-3">
        {% block product_category %}
            {{ sonata_block_render({'type': 'sonata.product.block.categories_menu', 'settings': {
                'current_uri': app.request.requestUri,
                'extra_cache_keys': {
                    'block_id':    'sonata.product.block.categories_menu',
                    'updated_at':  'now',
                },
                'facets': datagrid.query.results.facets is defined ? datagrid.query.results.facets.categories.terms : null,
                'route': app.request.attributes.get('_route'),
                'route_parameters': {sort: sort, q: q},
                'ttl': 60
            }}) }}
        {% endblock %}

        {% block product_filter %}
            {% if provider %}
                <div class="well" style="padding: 8px 0;">
                    {{ sonata_block_render({'type': 'sonata.product.block.filters_menu'}, {
                        'product_provider': provider,
                        'current_uri': app.request.requestUri,
                        'route': app.request.attributes.get('_route'),
                        'route_parameters': {sort: sort, q: q, category: category}
                    }) }}
                </div>
            {% endif %}
        {% endblock %}

    </div>

    <div class="col-sm-9">

        {% if datagrid.pager.count == 0 %}

            {% block no_products %}
                <div class="no-products-available">
                    {% trans from 'SonataProductBundle' %}no_products_available{% endtrans %}
                </div>
            {% endblock %}

        {% else %}

            <div class="panel panel-default sonata-product-navigation-bar">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-sm-3">
                            <h4 class="panel-title">"{{ q }}"</h4>
                        </div>
                        <form name="search-sort" data-name="sonata-select" method="get" action="{{ path(app.request.attributes.get('_route')) }}">
                            {{ form_widget(form.sort, {horizontal_input_wrapper_class: 'col-sm-4'}) }}
                            {{ form_rest(form) }}
                        </form>
                        <div class="col-sm-5">
                            {% include 'SonataDatagridBundle:Search:pager.html.twig' with {'pager_class': 'pull-right'} %}
                        </div>
                    </div>
                </div>

                {% block products %}{% endblock %}

                <div class="panel-footer">
                    <div class="row">
                        <div class="col-sm-12">
                            {% include 'SonataDatagridBundle:Search:pager.html.twig' with {'pager_class': 'pull-right'} %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

    </div>

</div>
